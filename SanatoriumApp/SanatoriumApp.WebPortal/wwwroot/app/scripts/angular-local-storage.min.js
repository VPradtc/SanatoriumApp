var isDefined=angular.isDefined,isUndefined=angular.isUndefined,isNumber=angular.isNumber,isObject=angular.isObject,isArray=angular.isArray,extend=angular.extend,toJson=angular.toJson;angular.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls";this.storageType="localStorage";this.cookie={expiry:30,path:"/"};this.notify={setItem:!0,removeItem:!1};this.setPrefix=function(n){return this.prefix=n,this};this.setStorageType=function(n){return this.storageType=n,this};this.setStorageCookie=function(n,t){return this.cookie.expiry=n,this.cookie.path=t,this};this.setStorageCookieDomain=function(n){return this.cookie.domain=n,this};this.setNotify=function(n,t){return this.notify={setItem:n,removeItem:t},this};this.$get=["$rootScope","$window","$document","$parse",function(n,t,i,r){var f=this,u=f.prefix,c=f.cookie,a=f.notify,h=f.storageType,e;i?i[0]&&(i=i[0]):i=document;u.substr(-1)!=="."&&(u=!u?"":u+".");var s=function(n){return u+n},o=function(){try{var i=h in t&&t[h]!==null,r=s("__"+Math.round(Math.random()*1e7));return i&&(e=t[h],e.setItem(r,""),e.removeItem(r)),i}catch(u){return h="cookie",n.$broadcast("LocalStorageModule.notification.error",u.message),!1}}(),y=function(t,i){if(i=isUndefined(i)?null:toJson(i),!o||f.storageType==="cookie")return o||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),a.setItem&&n.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:i,storageType:"cookie"}),l(t,i);try{e&&e.setItem(s(t),i);a.setItem&&n.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:i,storageType:f.storageType})}catch(r){return n.$broadcast("LocalStorageModule.notification.error",r.message),l(t,i)}return!0},b=function(t){if(!o||f.storageType==="cookie")return o||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),d(t);var i=e?e.getItem(s(t)):null;if(!i||i==="null")return null;try{return JSON.parse(i)}catch(r){return i}},k=function(){for(var t,i=0;i<arguments.length;i++)if(t=arguments[i],o&&f.storageType!=="cookie")try{e.removeItem(s(t));a.removeItem&&n.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:f.storageType})}catch(r){n.$broadcast("LocalStorageModule.notification.error",r.message);v(t)}else o||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),a.removeItem&&n.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:"cookie"}),v(t)},g=function(){var t,i,r;if(!o)return n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];t=u.length;i=[];for(r in e)if(r.substr(0,t)===u)try{i.push(r.substr(t))}catch(f){return n.$broadcast("LocalStorageModule.notification.error",f.Description),[]}return i},nt=function(t){var s=!u?new RegExp:new RegExp("^"+u),h=!t?new RegExp:new RegExp(t),r,i;if(!o||f.storageType==="cookie")return o||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),w();r=u.length;for(i in e)if(s.test(i)&&h.test(i.substr(r)))try{k(i.substr(r))}catch(c){return n.$broadcast("LocalStorageModule.notification.error",c.message),w()}return!0},p=function(){try{return t.navigator.cookieEnabled||"cookie"in i&&(i.cookie.length>0||(i.cookie="test").indexOf.call(i.cookie,"test")>-1)}catch(r){return n.$broadcast("LocalStorageModule.notification.error",r.message),!1}}(),l=function(t,r,u){var h;if(isUndefined(r))return!1;if((isArray(r)||isObject(r))&&(r=toJson(r)),!p)return n.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var e="",f=new Date,o="";r===null?(f.setTime(f.getTime()+-864e5),e="; expires="+f.toGMTString(),r=""):isNumber(u)&&u!==0?(f.setTime(f.getTime()+u*864e5),e="; expires="+f.toGMTString()):c.expiry!==0&&(f.setTime(f.getTime()+c.expiry*864e5),e="; expires="+f.toGMTString());!t||(h="; path="+c.path,c.domain&&(o="; domain="+c.domain),i.cookie=s(t)+"="+encodeURIComponent(r)+e+h+o)}catch(l){return n.$broadcast("LocalStorageModule.notification.error",l.message),!1}return!0},d=function(t){var e,f,r,o;if(!p)return n.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(e=i.cookie&&i.cookie.split(";")||[],f=0;f<e.length;f++){for(r=e[f];r.charAt(0)===" ";)r=r.substring(1,r.length);if(r.indexOf(s(t)+"=")===0){o=decodeURIComponent(r.substring(u.length+t.length+1,r.length));try{return JSON.parse(o)}catch(h){return o}}}return null},v=function(n){l(n,null)},w=function(){for(var f,n=null,e=u.length,r=i.cookie.split(";"),t=0;t<r.length;t++){for(n=r[t];n.charAt(0)===" ";)n=n.substring(1,n.length);f=n.substring(e,n.indexOf("="));v(f)}},tt=function(){return h},it=function(n,t,i,u){u=u||t;var f=b(u);return f===null&&isDefined(i)?f=i:isObject(f)&&isObject(i)&&(f=extend(f,i)),r(t).assign(n,f),n.$watch(t,function(n){y(u,n)},isObject(n[t]))},rt=function(){for(var i=0,r=t[h],n=0;n<r.length;n++)r.key(n).indexOf(u)===0&&i++;return i};return{isSupported:o,getStorageType:tt,set:y,add:y,get:b,keys:g,remove:k,clearAll:nt,bind:it,deriveKey:s,length:rt,cookie:{isSupported:p,set:l,add:l,get:d,remove:v,clearAll:w}}}]});